# Timeline æ ‡è®°ä¸å¸§æ•°å­—é‡å ä¼˜åŒ– v2

## ğŸ¯ æ”¹è¿›æ–¹æ¡ˆ

å½“ Animation End æ ‡è®°çš„**æ–‡å­—æ ‡ç­¾**ï¼ˆå†™åœ¨çº¢çº¿å³è¾¹ï¼‰ä¸å¸§æ•°å­—é‡å æ—¶ï¼š
- å°†**å³è¾¹çš„å¸§æ•°å­—**ç§»åˆ°åº•éƒ¨æ˜¾ç¤º
- **END æ ‡ç­¾ç¼©å°ä¸ºä¸€åŠå°ºå¯¸**

## ğŸ“ å…³é”®ç†è§£

### æ ‡è®°å¸ƒå±€

```
Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45  50â”‚[END] 60  65  70     â”‚
â”‚       â”‚                     â”‚
â”‚       çº¢çº¿  â†‘                â”‚
â”‚          æ ‡ç­¾åœ¨å³è¾¹           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ‡è®°åœ¨ Frame 50:
- çº¢çº¿åœ¨ Frame 50 å³è¾¹ç•Œ
- æ ‡ç­¾ "END" å†™åœ¨çº¢çº¿å³è¾¹
- æ ‡ç­¾å ç”¨çº¦ 1-2 ä¸ª cell çš„å®½åº¦
- å¯èƒ½é®æŒ¡å³è¾¹ 1-2 å¸§çš„å¸§æ•°å­—
```

### é‡å æƒ…å†µ

```
æ ‡è®°åœ¨ Frame 48ï¼Œæ ‡ç­¾å‘å³å»¶ä¼¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45â”‚[END] 55  60  65  70     â”‚  â† Frame 50 è¢«é®æŒ¡
â”‚   â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§£å†³æ–¹æ¡ˆ:
1. å°† Frame 50 ç§»åˆ°åº•éƒ¨
2. END æ ‡ç­¾ç¼©å°ä¸ºä¸€åŠ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45â”‚[END] 55  60  65  70     â”‚  â† å°å· END
â”‚   â”‚  50                     â”‚  â† Frame 50 ç§»åˆ°åº•éƒ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. æ£€æµ‹é‡å 

```typescript
// æ ‡è®°æ–‡å­—åœ¨çº¢çº¿å³è¾¹ï¼Œå ç”¨çº¦ 1-2 ä¸ª cell å®½åº¦
// æ£€æŸ¥å½“å‰å¸§æ•°å­—æ˜¯å¦åœ¨æ ‡è®°å³ä¾§ 1-2 å¸§çš„èŒƒå›´å†…
const markerIsNearby = animEndFrame >= 0 && 
                       frame > animEndFrame &&      // åœ¨æ ‡è®°å³è¾¹
                       frame <= animEndFrame + 2;   // åœ¨ 2 å¸§èŒƒå›´å†…
```

### 2. ç»˜åˆ¶å¸§æ•°å­—ï¼ˆç§»åˆ°åº•éƒ¨é¿å¼€æ ‡è®°ï¼‰

```typescript
for (let frame = 0; frame < frameCount; frame++) {
  if (frame % 5 === 0) {
    const markerIsNearby = animEndFrame >= 0 && 
                           frame > animEndFrame && 
                           frame <= animEndFrame + 2;
    
    if (markerIsNearby) {
      // ç§»åˆ°åº•éƒ¨é¿å¼€æ ‡è®°æ–‡å­—
      ctx.fillStyle = '#999';
      ctx.font = '9px Arial';
      ctx.fillText((frame + 1).toString(), x + CELL_WIDTH / 2, HEADER_HEIGHT - 4);
    } else {
      // æ­£å¸¸å±…ä¸­
      ctx.fillStyle = '#fff';
      ctx.fillText((frame + 1).toString(), x + CELL_WIDTH / 2, HEADER_HEIGHT / 2);
    }
  }
}
```

### 3. ç»˜åˆ¶æ ‡è®°ï¼ˆæ£€æµ‹é‡å ï¼ŒåŠ¨æ€è°ƒæ•´å¤§å°ï¼‰

```typescript
if (animationEndFrame !== null && animationEndFrame >= 0) {
  const animEndX = TRACK_NAME_WIDTH + animationEndFrame * CELL_WIDTH + CELL_WIDTH;
  
  // ç»˜åˆ¶çº¢è‰²ç²—çº¿
  ctx.strokeStyle = '#ff4d4f';
  ctx.lineWidth = 3;
  ctx.moveTo(animEndX, 0);
  ctx.lineTo(animEndX, HEADER_HEIGHT);
  ctx.stroke();

  // æ£€æŸ¥æ˜¯å¦ä¼šä¸å³è¾¹ 1-2 å¸§çš„å¸§æ•°å­—é‡å 
  let hasOverlap = false;
  for (let f = animationEndFrame + 1; f <= animationEndFrame + 2; f++) {
    if (f < frameCount && f % 5 === 0) {
      hasOverlap = true;
      break;
    }
  }

  const animLabelX = animEndX + 2;
  const animLabelY = HEADER_HEIGHT / 2;

  if (hasOverlap) {
    // ä¸€åŠå°ºå¯¸
    ctx.fillStyle = 'rgba(42, 42, 42, 0.95)';
    ctx.fillRect(animLabelX - 1, animLabelY - 6, 16, 10);
    ctx.fillStyle = '#ff4d4f';
    ctx.font = 'bold 7px Arial';  // å°å·
    ctx.fillText('END', animLabelX, animLabelY);
  } else {
    // æ­£å¸¸å°ºå¯¸
    ctx.fillStyle = 'rgba(42, 42, 42, 0.95)';
    ctx.fillRect(animLabelX - 1, animLabelY - 7, 22, 12);
    ctx.fillStyle = '#ff4d4f';
    ctx.font = 'bold 9px Arial';  // æ­£å¸¸
    ctx.fillText('END', animLabelX, animLabelY);
  }
}
```

## ğŸ¨ è§†è§‰å¯¹æ¯”

### Before (å¸§æ•°å­—è¢«é®æŒ¡)

```
45  50â”‚[END]     65  70  75
      â”‚
      çº¢çº¿
          
é—®é¢˜ï¼šFrame 55 çš„æ•°å­—çœ‹ä¸æ¸…
```

### After (å¸§æ•°å­—ç§»åˆ°åº•éƒ¨ï¼Œæ ‡ç­¾ç¼©å°)

```
45  50â”‚[END] 60  65  70  75
      â”‚   â†‘ ç¼©å°çš„ END
         55  â†‘ Frame 55 ç§»åˆ°åº•éƒ¨
      çº¢çº¿
    
ä¼˜åŠ¿ï¼š
- Frame 50 æ­£å¸¸æ˜¾ç¤º
- Frame 55 ç§»åˆ°åº•éƒ¨ï¼ˆé¿å¼€æ ‡ç­¾ï¼‰
- END æ ‡ç­¾ç¼©å°ï¼Œä¸æ‹¥æŒ¤
- ä¿¡æ¯å®Œæ•´ï¼Œä¸é‡å 
```

## ğŸ“Š å°ºå¯¸å¯¹æ¯”

| å…ƒç´  | æ­£å¸¸ | æœ‰é‡å æ—¶ |
|-----|------|--------|
| å¸§æ•°å­— | 11px, å±…ä¸­ (y=15) | 9px, åº•éƒ¨ (y=26) |
| END æ ‡ç­¾ | 9px bold, å±…ä¸­ | 7px bold, å±…ä¸­ |
| æ ‡ç­¾èƒŒæ™¯ | 22Ã—12px | 16Ã—10px |

## ğŸ’¡ è®¾è®¡æ€è·¯

### ä¸ºä»€ä¹ˆä¸€ä¸Šä¸€ä¸‹ï¼Ÿ

```
é¡¶éƒ¨ï¼šæ ‡è®° "ANIM"
- æ›´é‡è¦ï¼Œéœ€è¦é†’ç›®
- çº¢è‰²ï¼Œå®¹æ˜“è¯†åˆ«

åº•éƒ¨ï¼šå¸§æ•°å­— "50"
- æä¾›ç²¾ç¡®ä¿¡æ¯
- ç°è‰²ï¼Œä¸æŠ¢çœ¼
- ç¼©å°é¿å…æ‹¥æŒ¤
```

### ä¸ºä»€ä¹ˆç¼©å°ï¼Ÿ

```
30px çš„ Header é«˜åº¦æœ‰é™ï¼š
- æ­£å¸¸å­—ä½“ä¼šæŒ¤åœ¨ä¸€èµ·
- ç¼©å°åå¯ä»¥æ¸…æ¥šåˆ†å¼€
- ä»ç„¶å¯è¯»
```

### ä¸ºä»€ä¹ˆæ ‡è®°æ”¹ä¸ºå•è¡Œï¼Ÿ

```
é‡å æ—¶ç©ºé—´ç´§å¼ ï¼š
- "ANIM" å·²ç»è¶³å¤Ÿè¯†åˆ«
- "END" å¯ä»¥çœç•¥
- èŠ‚çœå‚ç›´ç©ºé—´ç»™å¸§æ•°å­—
```

## ğŸ¯ å„ç§åœºæ™¯

### åœºæ™¯ 1: æ ‡è®°åœ¨ Frame 50 (ç´§é‚» Frame 55)

```
Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45  50â”‚[END] 60  65  70    â”‚ â† Frame 50 æ­£å¸¸
â”‚       â”‚  â†‘                 â”‚ â† å°å· END
â”‚       çº¢çº¿ 55               â”‚ â† Frame 55 ç§»åˆ°åº•éƒ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 2: æ ‡è®°åœ¨ Frame 47 (ä¸å½±å“å¸§æ•°å­—)

```
Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45â”‚[END] 50  55  60  65    â”‚ â† Frame 50 ä¸å—å½±å“
â”‚   â”‚                        â”‚ â† æ­£å¸¸ END
â”‚   çº¢çº¿                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 3: æ ‡è®°åœ¨ Frame 98 (ç´§é‚» Frame 100)

```
Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 95â”‚[END] 105  110  115     â”‚ â† Frame 100 ç§»åˆ°åº•éƒ¨
â”‚   â”‚  â†‘                     â”‚ â† å°å· END
â”‚   çº¢çº¿100                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 4: æ ‡è®°åœ¨ Frame 118 (æ¥è¿‘æœ«å°¾)

```
Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 115â”‚[END]â”‚PROJECT END       â”‚ â† å°å· END
â”‚    â”‚     120               â”‚ â† Frame 120 ç§»åˆ°åº•éƒ¨
â”‚    çº¢çº¿                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å¯¹æ¯”ä¸‰ä¸ªç‰ˆæœ¬

### v0 (åŸå§‹)
```
é—®é¢˜ï¼šæ ‡è®°å’Œæ•°å­—å®Œå…¨é‡å ï¼Œçœ‹ä¸æ¸…
[ANIM50]  â† æ··åœ¨ä¸€èµ·
[END  ]
```

### v1 (è·³è¿‡æ•°å­—)
```
æ”¹è¿›ï¼šæ¸…æ™°ä½†ä¸¢å¤±ä¿¡æ¯
[ANIM]  â† æ¸…æ™°
[END ]
(50å“ªå»äº†ï¼Ÿ) â† ç¼ºå¤±
```

### v2 (ä¸€ä¸Šä¸€ä¸‹)
```
å®Œç¾ï¼šæ¸…æ™°ä¸”å®Œæ•´
[ANIM]  â† é¡¶éƒ¨ï¼Œæ¸…æ™°
  50    â† åº•éƒ¨ï¼Œå®Œæ•´
```

## ğŸ‰ æ€»ç»“

ç°åœ¨ Timeline æ ‡è®°çš„æ˜¾ç¤ºæ›´åŠ æ™ºèƒ½ï¼š

âœ… **ä¸ä¸¢å¤±ä¿¡æ¯** - å¸§æ•°å­—å§‹ç»ˆæ˜¾ç¤º
âœ… **ä¸é‡å ** - ä¸€ä¸Šä¸€ä¸‹ï¼Œæ¸…æ™°åˆ†ç¦»
âœ… **è‡ªé€‚åº”** - æ ¹æ®æ˜¯å¦é‡å è‡ªåŠ¨è°ƒæ•´å¤§å°å’Œä½ç½®
âœ… **ä¿æŒå¯è¯»** - å³ä½¿ç¼©å°ä¹Ÿæ¸…æ™°å¯è¯»

ç”¨æˆ·ä½“éªŒå®Œç¾ï¼ğŸš€

