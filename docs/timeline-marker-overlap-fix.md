# Timeline æ ‡è®°ä¸å¸§æ•°å­—é‡å ä¼˜åŒ–

## ğŸ¯ é—®é¢˜

Animation End æ ‡è®°å’Œå¸§æ•°å­—å¯èƒ½ä¼šé‡å ï¼Œå¯¼è‡´æ˜¾ç¤ºä¸æ¸…æ¥šï¼š

```
Before âŒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45  50  55â”‚ANIM END  60  65    â”‚  â† "55" å’Œ "ANIM END" é‡å 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. è·³è¿‡æ ‡è®°é™„è¿‘çš„å¸§æ•°å­—

åœ¨ç»˜åˆ¶å¸§æ•°å­—æ—¶ï¼Œæ£€æµ‹å¹¶è·³è¿‡æ ‡è®°é™„è¿‘çš„å¸§ï¼ˆÂ±2 å¸§èŒƒå›´ï¼‰ï¼š

```typescript
// Calculate marker positions
const animEndFrame = animationEndFrame ?? -1;

// Frames to skip (near markers, within 2 frames range)
const skipFrames = new Set<number>();
if (animEndFrame >= 0) {
  for (let i = animEndFrame - 2; i <= animEndFrame + 2; i++) {
    if (i >= 0 && i < frameCount) skipFrames.add(i);
  }
}

// Draw frame numbers
for (let frame = 0; frame < frameCount; frame++) {
  if (frame % 5 === 0 && !skipFrames.has(frame)) {
    // Draw frame number
  }
}
```

### 2. æ ‡è®°æ–‡å­—æ·»åŠ èƒŒæ™¯

ç»™æ ‡è®°æ–‡å­—æ·»åŠ åŠé€æ˜èƒŒæ™¯ï¼Œè®©æ–‡å­—æ›´æ¸…æ™°ï¼š

```typescript
// Animation End Marker
const animLabelX = animEndX + 3;
const animLabelY1 = 5;
const animLabelY2 = 15;

// Background (semi-transparent dark)
ctx.fillStyle = 'rgba(42, 42, 42, 0.95)';
ctx.fillRect(animLabelX - 1, animLabelY1 - 1, 32, 22);

// Text
ctx.fillStyle = '#ff4d4f';
ctx.font = 'bold 9px Arial';
ctx.fillText('ANIM', animLabelX, animLabelY1 + 4);
ctx.fillText('END', animLabelX, animLabelY2 + 4);
```

### 3. è°ƒæ•´æ ‡è®°æ–‡å­—ä½ç½®

- **ANIM END**: æ”¾åœ¨é¡¶éƒ¨ï¼ˆy = 5, 15ï¼‰
- **PROJECT END**: æ”¾åœ¨ä¸­é—´ï¼ˆy = 12, 22ï¼‰

é¿å…æ‰€æœ‰æ ‡è®°éƒ½æŒ¤åœ¨ä¸­é—´ã€‚

## ğŸ¨ è§†è§‰æ•ˆæœ

### Before âŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45  50  55â”‚ANIM  60  65  70  75  80 ... â”‚
â”‚           â”‚END                           â”‚
â”‚           â†‘ é‡å ä¸æ¸…æ¥š                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 45  50    [ANIM]  65  70  75  80  85 ...â”‚
â”‚           [END ]                         â”‚
â”‚           â†‘ å¸¦èƒŒæ™¯ï¼Œæ¸…æ™°                  â”‚
â”‚           â†‘ è·³è¿‡äº† Frame 55 çš„æ•°å­—       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ä¼˜åŒ–å¯¹æ¯”

| æ–¹é¢ | Before | After |
|-----|--------|-------|
| å¸§æ•°å­— | æ‰€æœ‰å¸§éƒ½æ˜¾ç¤º | è·³è¿‡æ ‡è®°é™„è¿‘ Â±2 å¸§ |
| æ ‡è®°èƒŒæ™¯ | æ—  | åŠé€æ˜èƒŒæ™¯é®ç½© |
| æ ‡è®°ä½ç½® | éƒ½åœ¨ä¸­é—´ | ANIM é¡¶éƒ¨ï¼ŒPROJECT ä¸­é—´ |
| å¯è¯»æ€§ | â­â­ | â­â­â­â­â­ |

## ğŸ”§ å®ç°ç»†èŠ‚

### è·³è¿‡èŒƒå›´è®¡ç®—

```typescript
// Animation End at Frame 50
animEndFrame = 50;

// Skip frames: 48, 49, 50, 51, 52
skipFrames = new Set([48, 49, 50, 51, 52]);

// When drawing:
// Frame 45 (45 % 5 === 0): Draw âœ“
// Frame 50 (50 % 5 === 0): Skip (in skipFrames) âœ“
// Frame 55 (55 % 5 === 0): Draw âœ“
```

### èƒŒæ™¯å°ºå¯¸

```typescript
// ANIM END label
width: 32px (é€‚åˆ "ANIM" å’Œ "END" æ–‡å­—)
height: 22px (ä¸¤è¡Œæ–‡å­— + padding)

// PROJECT END label
width: 42px (é€‚åˆ "PROJECT" å’Œ "END" æ–‡å­—)
height: 13px (ä¸¤è¡Œæ–‡å­— + padding)
```

### ä½ç½®è°ƒæ•´

```typescript
// ANIM END (çº¢è‰²) - é¡¶éƒ¨
Y positions: 5px, 15px
â†’ é è¿‘ header é¡¶éƒ¨ï¼Œé†’ç›®

// PROJECT END (ç°è‰²) - ä¸­é—´
Y positions: 12px, 22px
â†’ header ä¸­é—´ï¼Œä¸æŠ¢çœ¼
```

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡

### 1. è·³è¿‡å¸§æ•°å­—

```
å¦‚æœä¸è·³è¿‡ï¼š
Frame 50 çš„æ•°å­— "51" ä¼šå’Œ "ANIM END" é‡å 
```

### 2. æ·»åŠ èƒŒæ™¯

```
æ²¡æœ‰èƒŒæ™¯ï¼š
- çº¢è‰²æ–‡å­—åœ¨æ·±è‰²èƒŒæ™¯ä¸Šå¯èƒ½ä¸å¤Ÿæ¸…æ™°
- å¦‚æœä¸‹é¢æœ‰å†…å®¹ï¼Œå¯èƒ½ç©¿é€

æœ‰èƒŒæ™¯ï¼š
- æ–‡å­—å§‹ç»ˆæ¸…æ™°å¯è¯»
- ä¸ä¸‹é¢çš„è½¨é“å†…å®¹åˆ†ç¦»
```

### 3. ä¸åŒä½ç½®

```
å¦‚æœéƒ½åœ¨ä¸­é—´ï¼š
- ä¸¤ä¸ªæ ‡è®°é å¾—å¤ªè¿‘æ—¶ä¼šé‡å 
- éƒ½æŠ¢çœ¼ï¼Œæ²¡æœ‰ä¸»æ¬¡

é¡¶éƒ¨ vs ä¸­é—´ï¼š
- ANIM END æ›´é‡è¦ï¼Œæ”¾é¡¶éƒ¨
- PROJECT END æ˜¯å‚è€ƒä¿¡æ¯ï¼Œæ”¾ä¸­é—´
```

## ğŸ¯ ç‰¹æ®Šæƒ…å†µå¤„ç†

### æƒ…å†µ 1: æ ‡è®°åœ¨ Frame 5 çš„å€æ•°ä¸Š

```
ANIM END at Frame 50
â†’ Frame 50 çš„æ•°å­—ä¼šè¢«è·³è¿‡
â†’ æ ‡è®°æ¸…æ™°æ˜¾ç¤º
```

### æƒ…å†µ 2: æ ‡è®°åœ¨ Frame 5 çš„å€æ•°é™„è¿‘

```
ANIM END at Frame 52
â†’ Frame 50 å’Œ 55 çš„æ•°å­—éƒ½ä¼šè¢«è·³è¿‡ï¼ˆÂ±2 èŒƒå›´ï¼‰
â†’ ç•™å‡ºè¶³å¤Ÿç©ºé—´ç»™æ ‡è®°
```

### æƒ…å†µ 3: ä¸¤ä¸ªæ ‡è®°å¾ˆè¿‘

```
ANIM END at Frame 50
PROJECT END at Frame 55

â†’ Frame 50, 55 éƒ½è¢«è·³è¿‡
â†’ ä¸¤ä¸ªæ ‡è®°åˆ†åˆ«æ˜¾ç¤º
â†’ ä½ç½®ä¸åŒï¼ˆé¡¶éƒ¨ vs ä¸­é—´ï¼‰
```

### æƒ…å†µ 4: æ ‡è®°åœ¨è¾¹ç¼˜

```
ANIM END at Frame 2
â†’ skipFrames: [0, 1, 2, 3, 4]
â†’ Frame 0, 5 çš„æ•°å­—è¢«è·³è¿‡
â†’ æ ‡è®°ä»ç„¶æ¸…æ™°
```

## ğŸ¨ ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„ç»˜åˆ¶é€»è¾‘

```typescript
const drawFrameHeader = (ctx, totalWidth) => {
  // 1. ç»˜åˆ¶èƒŒæ™¯
  ctx.fillStyle = '#2a2a2a';
  ctx.fillRect(0, 0, totalWidth, HEADER_HEIGHT);

  // 2. è®¡ç®—è·³è¿‡çš„å¸§
  const skipFrames = new Set<number>();
  if (animationEndFrame !== null && animationEndFrame >= 0) {
    for (let i = animationEndFrame - 2; i <= animationEndFrame + 2; i++) {
      if (i >= 0 && i < frameCount) skipFrames.add(i);
    }
  }

  // 3. ç»˜åˆ¶å¸§æ•°å­—ï¼ˆè·³è¿‡æ ‡è®°é™„è¿‘ï¼‰
  for (let frame = 0; frame < frameCount; frame++) {
    if (frame % 5 === 0 && !skipFrames.has(frame)) {
      ctx.fillText((frame + 1).toString(), x + CELL_WIDTH / 2, HEADER_HEIGHT / 2);
    }
  }

  // 4. ç»˜åˆ¶ PROJECT END æ ‡è®°
  // - ç°è‰²ç»†çº¿
  // - å¸¦èƒŒæ™¯çš„æ ‡ç­¾
  // - ä½ç½®ï¼šä¸­é—´

  // 5. ç»˜åˆ¶ ANIM END æ ‡è®°
  // - çº¢è‰²ç²—çº¿
  // - å¸¦èƒŒæ™¯çš„æ ‡ç­¾
  // - ä½ç½®ï¼šé¡¶éƒ¨
};
```

## ğŸ‰ æ€»ç»“

ç°åœ¨ Timeline æ ‡è®°æ›´åŠ æ¸…æ™°ï¼š

âœ… **ä¸é‡å ** - è‡ªåŠ¨è·³è¿‡æ ‡è®°é™„è¿‘çš„å¸§æ•°å­—
âœ… **èƒŒæ™¯é®ç½©** - æ–‡å­—å§‹ç»ˆæ¸…æ™°å¯è¯»
âœ… **ä½ç½®åˆ†ç¦»** - ä¸åŒæ ‡è®°åœ¨ä¸åŒé«˜åº¦
âœ… **è‡ªåŠ¨é€‚é…** - å¤„ç†å„ç§è¾¹ç¼˜æƒ…å†µ

ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡ï¼ğŸš€

